<div class="m-form">
    <Card Title="@Title">
        <Content>
            <div class="form-row">
                <div class="form-group col col-12 col-md-3">
                    <label class="m-label" for="packageNumber">Package Item Number</label>
                    <input type="text" class="form-control m-uppercase" id="packageNumber" autocomplete="off" @bind-value="Item.ItemNumber">
                </div>
                <div class="form-group col col-12 col-md-9">
                    <label class="m-label" for="description">Description</label>
                    <input type="text" class="form-control" id="description" autocomplete="off" @bind-value="Item.Description">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col col-12 col-md-3 col-lg-2">
                    <label class="m-label" for="partPrice">Base Part Price</label>
                    <TelerikNumericTextBox @bind-Value="Item.Package.BasePartsAmount"
                                           Format="C"
                                           Arrows="false">
                    </TelerikNumericTextBox>
                </div>
                <div class="form-group col col-12 col-md-3 col-lg-2">
                    <label class="m-label" for="laborPrice">Base Labor Price</label>
                    <TelerikNumericTextBox @bind-Value="Item.Package.BaseLaborAmount"
                                           Format="C"
                                           Arrows="false">
                    </TelerikNumericTextBox>
                </div>
                <div class="form-group col col-12 col-md-3 col-lg-2">
                    <label class="m-label" for="basePrice">Base Total</label>
                    <TelerikNumericTextBox @bind-Value="Item.Package.BaseLaborAmount"
                                           Format="C"
                                           Arrows="false">
                    </TelerikNumericTextBox>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col col-12">
                    <TelerikCheckBox Id="discount" @bind-Value="Item.Package.IsDiscountable" />
                    <label class="m-label" for="discount">Discountable</label>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col">
                    <SfTab ShowCloseButton="false" OverflowMode="OverflowMode.Scrollable" HeaderPlacement="HeaderPosition.Top" CssClass="e-background m-tabs">
                        <TabAnimationSettings>
                            <TabAnimationPrevious Effect="AnimationEffect.None"></TabAnimationPrevious>
                            <TabAnimationNext Effect="AnimationEffect.None"></TabAnimationNext>
                        </TabAnimationSettings>
                        <TabItems>
                            <TabItem CssClass="m-tab-item">
                                <ChildContent>
                                    <TabHeader Text="Inventory Items"></TabHeader>
                                </ChildContent>
                                <ContentTemplate>
                                    @if (Item.Package.Items != null)
                                    {
                                        <div class="m-tab-content-border">
                                            <div class="m-tab-content">
                                                <TelerikGrid Data="Item.Package.Items"
                                                         OnRowClick="@OnItemRowSelected"
                                                         Sortable="true"
                                                         Pageable="true"
                                                         FilterMode="GridFilterMode.None"
                                                         ShowColumnMenu="false"
                                                         PageSize="5"
                                                         SelectionMode="GridSelectionMode.Single"
                                                         SelectedItemsChanged="@((IEnumerable<InventoryPackageItemToWrite> itemList) => OnItemSelect(itemList))"
                                                         SelectedItems="@SelectedItems"
                                                         @ref="@ItemsGrid">
                                                    <GridColumns>
                                                        <GridColumn Width="25%"
                                                                Field="@nameof(InventoryPackageItemToWrite.ItemNumber)"
                                                                Editable="false"
                                                                Title="Item Number"
                                                                ShowColumnChooser="false"
                                                                Lockable="false">
                                                        </GridColumn>
                                                        <GridColumn Width="35%"
                                                                Field="@nameof(InventoryPackageItemToWrite.Description)"
                                                                Editable="false"
                                                                Title="Description"
                                                                ShowColumnChooser="false"
                                                                Lockable="false">
                                                        </GridColumn>
                                                        <GridColumn Width="15%"
                                                                Field="@nameof(InventoryPackageItemToWrite.Quantity)"
                                                                Title="Quantity"
                                                                ShowColumnChooser="false"
                                                                Lockable="false"
                                                                ShowColumnMenu="false"
                                                                Sortable="false"
                                                                Filterable="false"
                                                                TextAlign="ColumnTextAlign.Right">
                                                            <Template>
                                                                @{
                                                                    var item = context as InventoryPackageItemToWrite;
                                                                <TelerikNumericTextBox @bind-Value="item.Quantity"
                                                                                   Arrows="false">
                                                                </TelerikNumericTextBox>
                                                            }
                                                        </Template>
                                                        <EditorTemplate>
                                                            @{
                                                                    var item = context as InventoryPackageItemToWrite;
                                                                <TelerikNumericTextBox @bind-Value="item.Quantity"
                                                                                   Arrows="false">
                                                                </TelerikNumericTextBox>
                                                            }
                                                        </EditorTemplate>
                                                    </GridColumn>
                                                    <GridColumn Width="25%" Title="Additional Charge">
                                                        <Columns>
                                                            <GridColumn Field="@nameof(InventoryPackageItemToWrite.PartAmountIsAdditional)"
                                                                        Title="Part">
                                                                <Template>
                                                                    @{
                                                                            var item = context as InventoryPackageItemToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.PartAmountIsAdditional" />
                                                                    }
                                                                </Template>
                                                                <EditorTemplate>
                                                                    @{
                                                                            var item = context as InventoryPackageItemToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.PartAmountIsAdditional" />
                                                                    }
                                                                </EditorTemplate>
                                                            </GridColumn>
                                                            <GridColumn Field="@nameof(InventoryPackageItemToWrite.LaborAmountIsAdditional)"
                                                                        Title="Labor">
                                                                <Template>
                                                                    @{
                                                                            var item = context as InventoryPackageItemToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.LaborAmountIsAdditional" />
                                                                    }
                                                                </Template>
                                                                <EditorTemplate>
                                                                    @{
                                                                            var item = context as InventoryPackageItemToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.LaborAmountIsAdditional" />
                                                                    }
                                                                </EditorTemplate>
                                                            </GridColumn>
                                                            <GridColumn Field="@nameof(InventoryPackageItemToWrite.ExciseFeeIsAdditional)"
                                                                        Title="Excise Fees">
                                                                <Template>
                                                                    @{
                                                                            var item = context as InventoryPackageItemToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.ExciseFeeIsAdditional" />
                                                                    }
                                                                </Template>
                                                                <EditorTemplate>
                                                                    @{
                                                                            var item = context as InventoryPackageItemToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.ExciseFeeIsAdditional" />
                                                                    }
                                                                </EditorTemplate>
                                                            </GridColumn>
                                                        </Columns>
                                                    </GridColumn>
                                                </GridColumns>
                                            </TelerikGrid>

                                            <div class="m-icon-button-group">
                                                <button class="btn m-icon-button m-add-btn" @onclick="OnAddItem"><i class="fas fa-plus"></i></button>
                                                <button class="btn m-icon-button m-delete-btn" @onclick="OnDeleteItemAsync" disabled="@(SelectedItem == null ? true : false)"><i class="fas fa-trash"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    }
                                </ContentTemplate>
                            </TabItem>
                            <TabItem CssClass="m-tab-item">
                                <ChildContent>
                                    <TabHeader Text="Placeholder Items"></TabHeader>
                                </ChildContent>
                                <ContentTemplate>
                                    @if (Item.Package.Placeholders != null)
                                    {
                                        <div class="m-tab-content-border">
                                            <div class="m-tab-content">
                                                <TelerikGrid Data="Item.Package.Placeholders"
                                                         OnRowClick="@OnPlaceholderRowSelected"
                                                         Sortable="true"
                                                         Pageable="true"
                                                         FilterMode="GridFilterMode.None"
                                                         ShowColumnMenu="false"
                                                         PageSize="5"
                                                         SelectionMode="GridSelectionMode.Single"
                                                         SelectedItemsChanged="@((IEnumerable<InventoryPackagePlaceholderToWrite> placeholderList) => OnPlaceholderSelect(placeholderList))"
                                                         SelectedItems="@SelectedPlaceholders"
                                                         @ref="@PlaceholdersGrid">
                                                    <GridColumns>
                                                        <GridColumn Field="@nameof(InventoryPackagePlaceholderToWrite.ItemType)"
                                                                Title="Part/Labor"
                                                                Width="10%">
                                                            <Template>
                                                                @{
                                                                    var placeholder = context as InventoryPackagePlaceholderToWrite;
                                                                <SfDropDownList TValue="PackagePlaceholderItemType"
                                                                            TItem="PlaceholderTypeListItem"
                                                                            PopupHeight="230px"
                                                                            DataSource="@placeholderTypeList"
                                                                                @bind-Value="@placeholder.ItemType">
                                                                    <DropDownListFieldSettings Text="Text" Value="Value" />
                                                                </SfDropDownList>
                                                            }
                                                        </Template>
                                                        <EditorTemplate>
                                                            @{
                                                                    var placeholder = context as InventoryPackagePlaceholderToWrite;
                                                                <SfDropDownList TValue="PackagePlaceholderItemType"
                                                                            TItem="PlaceholderTypeListItem"
                                                                            PopupHeight="230px"
                                                                            DataSource="@placeholderTypeList"
                                                                                @bind-Value="@placeholder.ItemType">
                                                                    <DropDownListFieldSettings Text="Text" Value="Value" />
                                                                </SfDropDownList>
                                                            }
                                                        </EditorTemplate>
                                                    </GridColumn>
                                                    <GridColumn Width="50%"
                                                                Field="@nameof(InventoryPackagePlaceholderToWrite.Description)"
                                                                Editable="false"
                                                                Title="Description"
                                                                ShowColumnChooser="false"
                                                                Lockable="false">
                                                        <Template>
                                                            @{
                                                                    var item = context as InventoryPackagePlaceholderToWrite;
                                                                <TelerikTextBox @bind-Value="item.Description">
                                                                </TelerikTextBox>
                                                            }
                                                        </Template>
                                                        <EditorTemplate>
                                                            @{
                                                                    var item = context as InventoryPackagePlaceholderToWrite;
                                                                <TelerikTextBox @bind-Value="item.Description">
                                                                </TelerikTextBox>
                                                            }
                                                        </EditorTemplate>
                                                    </GridColumn>
                                                    <GridColumn Width="10%"
                                                                Field="@nameof(InventoryPackagePlaceholderToWrite.Quantity)"
                                                                Title="Quantity"
                                                                ShowColumnChooser="false"
                                                                Lockable="false"
                                                                ShowColumnMenu="false"
                                                                Sortable="false"
                                                                Filterable="false"
                                                                TextAlign="ColumnTextAlign.Right">
                                                        <Template>
                                                            @{
                                                                    var item = context as InventoryPackagePlaceholderToWrite;
                                                                <TelerikNumericTextBox @bind-Value="item.Quantity"
                                                                                   Arrows="false">
                                                                </TelerikNumericTextBox>
                                                            }
                                                        </Template>
                                                        <EditorTemplate>
                                                            @{
                                                                    var item = context as InventoryPackagePlaceholderToWrite;
                                                                <TelerikNumericTextBox @bind-Value="item.Quantity"
                                                                                   Arrows="false">
                                                                </TelerikNumericTextBox>
                                                            }
                                                        </EditorTemplate>
                                                    </GridColumn>
                                                    <GridColumn Width="30%" Title="Additional Charge">
                                                        <Columns>
                                                            <GridColumn Field="@nameof(InventoryPackagePlaceholderToWrite.PartAmountIsAdditional)"
                                                                        Title="Part">
                                                                <Template>
                                                                    @{
                                                                            var item = context as InventoryPackagePlaceholderToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.PartAmountIsAdditional" />
                                                                    }
                                                                </Template>
                                                                <EditorTemplate>
                                                                    @{
                                                                            var item = context as InventoryPackagePlaceholderToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.PartAmountIsAdditional" />
                                                                    }
                                                                </EditorTemplate>
                                                            </GridColumn>
                                                            <GridColumn Field="@nameof(InventoryPackagePlaceholderToWrite.LaborAmountIsAdditional)"
                                                                        Title="Labor">
                                                                <Template>
                                                                    @{
                                                                            var item = context as InventoryPackagePlaceholderToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.LaborAmountIsAdditional" />
                                                                    }
                                                                </Template>
                                                                <EditorTemplate>
                                                                    @{
                                                                            var item = context as InventoryPackagePlaceholderToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.LaborAmountIsAdditional" />
                                                                    }
                                                                </EditorTemplate>
                                                            </GridColumn>
                                                            <GridColumn Field="@nameof(InventoryPackagePlaceholderToWrite.ExciseFeeIsAdditional)"
                                                                        Title="Excise Fees">
                                                                <Template>
                                                                    @{
                                                                            var item = context as InventoryPackagePlaceholderToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.ExciseFeeIsAdditional" />
                                                                    }
                                                                </Template>
                                                                <EditorTemplate>
                                                                    @{
                                                                            var item = context as InventoryPackagePlaceholderToWrite;
                                                                        <TelerikCheckBox @bind-Value="@item.ExciseFeeIsAdditional" />
                                                                    }
                                                                </EditorTemplate>
                                                            </GridColumn>
                                                        </Columns>
                                                    </GridColumn>
                                                </GridColumns>
                                            </TelerikGrid>

                                            <div class="m-icon-button-group">
                                                <button class="btn m-icon-button m-add-btn" @onclick="OnAddPlaceholder"><i class="fas fa-plus"></i></button>
                                                <button class="btn m-icon-button m-delete-btn" @onclick="OnDeletePlaceholderAsync" disabled="@(SelectedPlaceholder == null ? true : false)"><i class="fas fa-trash"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    }
                                </ContentTemplate>
                            </TabItem>

                            <TabItem CssClass="m-tab-item">
                                <ChildContent>
                                    <TabHeader Text="Script"></TabHeader>
                                </ChildContent>
                                <ContentTemplate>
                                    <div class="m-tab-content-border">
                                        <div class="m-tab-content">
                                            <TelerikEditor @bind-Value="@Item.Package.Script"
                                                           Width="100%"
                                                           Height="335px"
                                                           Tools="@EditTools">
                                            </TelerikEditor>
                                        </div>
                                    </div>
                                </ContentTemplate>
                            </TabItem>
                        </TabItems>
                    </SfTab>
                </div>
            </div>

            <SaveDiscardButtons OnSave="@OnValidSubmit" OnDiscard="@OnDiscard" />

        </Content>
    </Card>

</div>

@if (ItemFormMode == FormMode.Add)
{
    <InventoryItemSelectForm DialogVisible="true"
                         @bind-SelectedItem="@SelectedInventoryItem"
                         FilterPackagableItems="true"
                         OnSelect="@SubmitAddItemHandlerAsync"
                         OnCancel="@EndAddItem" />
}

<style>

    .e-tab.e-background .e-tab-header .e-toolbar-item .e-tab-text {
        color: black !important;
        font-size: 1rem !important;
    }

    .e-tab.e-background .e-tab-header .e-toolbar-item.e-active .e-tab-wrap {
        background: var(--bg-color-medium) !important;
        color: white !important;
        border-radius: 0.25rem 0.25rem 0 0;
    }

    .e-tab .e-tab-header.e-vertical {
        max-width: unset;
    }

    .k-grid {
        min-height: 300px !important;
    }

        .k-grid td > .k-checkbox {
            vertical-align: middle;
        }

    .e-ddl.e-input-group.e-control-wrapper .e-input {
        color: black;
        background-color: #e4e7eb !important;
        height: 36px;
        font-size: 1rem;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        padding: 0.375rem 1rem !important;
    }

    .e-ddl .e-input-group-icon.e-ddl-icon.e-icons, .e-ddl .e-input-group-icon.e-ddl-icon.e-icons:hover {
        color: black;
        background-color: #e4e7eb !important;
        font-size: 13px;
    }

    .e-dropdownbase .e-list-item, .e-dropdownbase .e-list-item.e-item-focus {
        background-color: white;
        color: black;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        font-size: 1rem;
        min-height: 29px;
    }

    .m-icon-button-divider {
        margin-top: 1em;
        border-color: darkgrey;
    }

    .m-icon-button-group {
        margin-top: .5em;
    }

</style>